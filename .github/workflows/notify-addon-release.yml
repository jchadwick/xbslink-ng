name: Notify Addon Release

on:
  release:
    types: [published]

jobs:
  notify:
    name: Notify Home Assistant Addon
    runs-on: ubuntu-latest

    steps:
      - name: Send repository dispatch to addon repo
        uses: peter-evans/repository-dispatch@v3
        with:
          # Requires a PAT with repo scope stored as ADDON_DISPATCH_TOKEN secret
          # If not set, falls back to GITHUB_TOKEN (will fail for cross-repo dispatch)
          token: ${{ secrets.ADDON_DISPATCH_TOKEN || secrets.GITHUB_TOKEN }}
          repository: jchadwick/home-assistant-addons
          event-type: xbslink-release
          client-payload: |
            {
              "version": "${{ github.event.release.tag_name }}",
              "release_url": "${{ github.event.release.html_url }}",
              "prerelease": ${{ github.event.release.prerelease }}
            }
